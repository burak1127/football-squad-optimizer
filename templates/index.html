<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SARICANLAR</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;800&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --fm-purple: #000000; --fm-dark: #000000; --fm-accent: #edf040; }
        body { font-family: 'Roboto Condensed', sans-serif; background-color: #f0f2f5; }
        .header-fm { background-color: var(--fm-purple); color: rgb(219, 231, 51); padding: 20px 0; border-bottom: 4px solid var(--fm-accent); font-family: 'Exo 2', sans-serif; }
        .card-fm { border: none; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden; }
        .card-header-fm { background-color: var(--fm-dark); color: white; font-weight: bold; text-transform: uppercase; padding: 12px; }
        .nav-tabs .nav-link.active { background-color: var(--fm-purple); color: white !important; border-color: var(--fm-purple); }
        .nav-tabs .nav-link { color: #333; font-weight: bold; }
        .btn-optimize { background: linear-gradient(45deg, var(--fm-purple), #000000); border: none; color: white; font-size: 1.2rem; font-weight: 800; }
        .attr-box { display: inline-block; width: 28px; text-align: center; border-radius: 4px; font-weight: bold; font-size: 0.8rem; color: white; margin-right: 2px; }
        .score-high { background-color: #198754; } .score-med { background-color: #ffc107; color: #333; }
        .captain-row { background-color: #fff9db !important; border-left: 5px solid #ffc107; }
        .form-label-sm { font-size: 0.75rem; font-weight: 700; color: #555; margin-bottom: 1px; }
        .form-control-sm { border: 1px solid #ced4da; font-weight: 600; font-size: 0.85rem; }
    </style>
</head>
<body>

<div class="header-fm mb-4">
    <div class="container d-flex justify-content-between align-items-center">
        <h2 class="m-0"><i class="bi bi-diagram-3-fill me-2"></i>FM SCOUT SARICANLAR</h2>
        <span class="badge bg-danger fs-6">**SARS襤襤**</span>
    </div>
</div>

<div class="container-fluid px-4">
    {% if hata %}
    <div class="alert alert-danger fw-bold text-center shadow-sm">{{ hata }}</div>
    {% endif %}

    <div class="row g-4">
        <div class="col-lg-5 col-xl-4">
            <div class="card card-fm h-100">
                <div class="card-header-fm"><i class="bi bi-person-plus-fill me-2"></i>Oyuncu Profili</div>
                <div class="card-body p-2">
                    <form action="/ekle" method="post">
                        
                        <div class="bg-light p-2 rounded mb-2 border">
                            <input type="text" name="isim" class="form-control form-control-sm fw-bold mb-2" placeholder="OYUNCU ADI" required>
                            <div class="row g-2">
                                <div class="col-6">
                                    <label class="form-label-sm">ANA MEVK襤</label>
                                    <select name="mevki_1" class="form-select form-select-sm fw-bold border-primary">
                                        <optgroup label="KALEC襤"><option value="GK">Kaleci (GK)</option></optgroup>
                                        <optgroup label="DEFANS">
                                            <option value="CB">Stoper (CB)</option>
                                            <option value="LB">Sol Bek (LB)</option>
                                            <option value="RB">Sa Bek (RB)</option>
                                            <option value="LWB">Sol Kanat Bek</option>
                                            <option value="RWB">Sa Kanat Bek</option>
                                        </optgroup>
                                        <optgroup label="ORTA SAHA">
                                            <option value="CDM">n Libero (CDM)</option>
                                            <option value="CM">Merkez Orta (CM)</option>
                                            <option value="CAM">Ofansif Orta (CAM)</option>
                                            <option value="LM">Sol Kanat (LM)</option>
                                            <option value="RM">Sa Kanat (RM)</option>
                                        </optgroup>
                                        <optgroup label="HCUM">
                                            <option value="LW">Sol A癟覺k (LW)</option>
                                            <option value="RW">Sa A癟覺k (RW)</option>
                                            <option value="ST">Santrafor (ST)</option>
                                            <option value="CF">Sahte 9 (CF)</option>
                                        </optgroup>
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label class="form-label-sm">YAN MEVK襤</label>
                                    <select name="mevki_2" class="form-select form-select-sm fw-bold">
                                        <option value="Yok" selected>-- Yok --</option>
                                        <optgroup label="KALEC襤"><option value="GK">Kaleci (GK)</option></optgroup>
                                        <optgroup label="DEFANS"><option value="CB">Stoper (CB)</option><option value="LB">Sol Bek (LB)</option><option value="RB">Sa Bek (RB)</option></optgroup>
                                        <optgroup label="ORTA SAHA"><option value="CDM">n Libero</option><option value="CM">Merkez Orta</option><option value="CAM">Ofansif Orta</option><option value="LM">Sol Kanat</option><option value="RM">Sa Kanat</option></optgroup>
                                        <optgroup label="HCUM"><option value="LW">Sol A癟覺k</option><option value="RW">Sa A癟覺k</option><option value="ST">Santrafor</option></optgroup>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <ul class="nav nav-tabs nav-fill mb-2" id="playerTabs" role="tablist">
                            <li class="nav-item"><button class="nav-link active py-1" data-bs-toggle="tab" data-bs-target="#teknik" type="button">TEKN襤K</button></li>
                            <li class="nav-item"><button class="nav-link py-1" data-bs-toggle="tab" data-bs-target="#zihinsel" type="button">Z襤H襤NSEL</button></li>
                            <li class="nav-item"><button class="nav-link py-1" data-bs-toggle="tab" data-bs-target="#fiziksel" type="button">F襤Z襤KSEL</button></li>
                        </ul>

                        <div class="tab-content" id="playerTabsContent">
                            <div class="tab-pane fade show active" id="teknik">
                                <div class="row g-1">
                                    <div class="col-4"><label class="form-label-sm">Bitiricilik</label><input type="number" name="bitiricilik" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Pas</label><input type="number" name="pas" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Orta Yapma</label><input type="number" name="orta_yapma" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Top S羹rme</label><input type="number" name="top_surme" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">襤lk Dokunu</label><input type="number" name="ilk_dokunus" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Teknik</label><input type="number" name="teknik" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Kafa</label><input type="number" name="kafa" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Markaj</label><input type="number" name="markaj" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Top alma</label><input type="number" name="top_calma" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Uzaktan ut</label><input type="number" name="uzaktan_sut" class="form-control form-control-sm" value="50"></div>
                                    
                                    <div class="col-12 text-center bg-light mt-1 py-1 text-muted small fw-bold border-top border-bottom">KALEC襤L襤K</div>
                                    <div class="col-4"><label class="form-label-sm">Refleks</label><input type="number" name="refleks" class="form-control form-control-sm" value="10"></div>
                                    <div class="col-4"><label class="form-label-sm">Birebir</label><input type="number" name="birebir" class="form-control form-control-sm" value="10"></div>
                                    <div class="col-4"><label class="form-label-sm">Elle Kont.</label><input type="number" name="elle_kontrol" class="form-control form-control-sm" value="10"></div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="zihinsel">
                                <div class="row g-1">
                                    <div class="col-4"><label class="form-label-sm text-danger">L襤DERL襤K</label><input type="number" name="liderlik" class="form-control form-control-sm border-danger" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Agresiflik</label><input type="number" name="agresiflik" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Karar</label><input type="number" name="karar" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Vizyon</label><input type="number" name="vizyon" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Pozisyon</label><input type="number" name="pozisyon" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Topsuz Alan</label><input type="number" name="top_suz_alan" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Konsantre</label><input type="number" name="konsantrasyon" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Soukkanl覺</label><input type="number" name="sogukkanlilik" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">Kararl覺l覺k</label><input type="number" name="kararlilik" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-4"><label class="form-label-sm">al覺kanl覺k</label><input type="number" name="caliskanlik" class="form-control form-control-sm" value="50"></div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="fiziksel">
                                <div class="row g-1">
                                    <div class="col-6"><label class="form-label-sm">H覺z</label><input type="number" name="hiz" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-6"><label class="form-label-sm">H覺zlanma</label><input type="number" name="hizlanma" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-6"><label class="form-label-sm">G羹癟</label><input type="number" name="guc" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-6"><label class="form-label-sm">Dayan覺kl覺l覺k</label><input type="number" name="dayaniklilik" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-6"><label class="form-label-sm">Z覺plama</label><input type="number" name="ziplama" class="form-control form-control-sm" value="50"></div>
                                    <div class="col-6"><label class="form-label-sm">Denge</label><input type="number" name="denge" class="form-control form-control-sm" value="50"></div>
                                </div>
                                <div class="mt-3">
                                    <button type="submit" class="btn btn-primary w-100 fw-bold py-2"><i class="bi bi-save me-2"></i>KAYDET</button>
                                </div>
                            </div>
                        </div>
                    </form>
                    <div class="p-2 border-top mt-2">
                        <a href="/ornek_veri" class="btn btn-sm w-100 fw-bold text-white shadow-sm" style="background: linear-gradient(45deg, #b31010, #ffaa00);"> rnek GS Kadrosunu Y羹kle</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-7 col-xl-8">
            
            <div class="card card-fm mb-3 border-primary" style="border-left: 5px solid #0d6efd;">
                <div class="card-body bg-white">
                    <form action="/optimize" method="post" class="row align-items-end g-3">
                        <div class="col-md-4">
                            <label class="form-label fw-bold text-primary small">KADRO BYKL (5-11)</label>
                            <input type="number" name="kisi_sayisi" id="kisiSayisiInput" class="form-control fw-bold fs-5 text-center border-primary" value="7" min="5" max="11" oninput="updateFormations()">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold text-primary small">D襤Z襤L襤 TERC襤H襤</label>
                            <select name="dizilis" id="dizilisSelect" class="form-select fw-bold border-primary">
                                <option value="farketmez" selected> Farketmez (Auto)</option>
                                </select>
                        </div>
                        <div class="col-md-4">
                            <button type="submit" class="btn btn-optimize w-100 shadow h-100 py-2"><i class="bi bi-cpu-fill me-2"></i>KADROYU KUR</button>
                        </div>
                    </form>
                </div>
            </div>

            {% if sonuc %}
            <div class="card card-fm mb-4 border-success" style="border-left: 6px solid #198754;">
                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-trophy-fill me-2"></i> OPT襤MUM KADRO ANAL襤Z襤</span>
                    <span class="badge bg-white text-success fw-bold">{{ tercih|upper }}</span>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover mb-0 align-middle">
                        <thead class="table-light text-secondary small">
                            <tr>
                                <th>Rol</th>
                                <th>襤sim</th>
                                <th>Oynat覺lan Mevki</th>
                                <th>Se癟ilme Nedeni (Kritik Stats)</th>
                                <th class="text-end">Perf. Puan覺</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for o in sonuc %}
                            <tr class="{% if 'KAPTAN' in o.rol %}captain-row fw-bold{% else %}table-success{% endif %}">
                                <td>
                                    {% if 'KAPTAN' in o.rol %}
                                        <span class="badge bg-warning text-dark"><i class="bi bi-star-fill"></i> KPT</span>
                                    {% else %}
                                        <span class="text-muted small">Oyn</span>
                                    {% endif %}
                                </td>
                                
                                <td>{{ o.isim }}</td>
                                
                                <td>
                                    <span class="badge bg-dark" style="font-size: 0.9rem; width: 45px;">{{ o.oynanan_mevki }}</span>
                                    {% if o.oynanan_mevki not in o.mevkiler[0] %} 
                                        <i class="bi bi-shuffle text-muted ms-1" title="Yan mevkide oynat覺l覺yor"></i>
                                    {% endif %}
                                </td>

                                <td>
                                    {% for k, v in o.sebeb_stats.items() %}
                                        <div class="d-inline-block me-2 mb-1" style="background: rgba(255,255,255,0.6); padding: 2px 6px; border-radius: 4px; border: 1px solid #ccc;">
                                            <small class="text-uppercase text-muted" style="font-size: 0.65rem;">{{ k }}</small>
                                            {% if v >= 80 %}
                                                <span class="fw-bold text-success">{{ v }}</span>
                                            {% elif v >= 60 %}
                                                <span class="fw-bold text-dark">{{ v }}</span>
                                            {% else %}
                                                <span class="fw-bold text-danger">{{ v }}</span>
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </td>

                                <td class="text-end">
                                    <span class="fw-bold fs-5 text-success">{{ o.oynanan_puan }}</span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="card-footer bg-white text-end fw-bold text-success">
                    Toplam Tak覺m G羹c羹: {{ guc }}
                </div>
            </div>
            {% endif %}

            <div class="card card-fm">
                <div class="card-header-fm d-flex justify-content-between align-items-center">
                    <span>OYUNCU L襤STES襤</span>
                    <span class="badge bg-secondary">{{ oyuncular|length }} Oyuncu</span>
                </div>
                <div class="card-body p-0 table-responsive" style="max-height: 450px; overflow-y: auto;">
                    <table class="table table-striped table-hover mb-0 align-middle">
                        <thead class="table-dark sticky-top">
                            <tr>
                                <th>襤sim</th>
                                <th>Mevkiler</th>
                                <th>Puanlar</th>
                                <th>Sil</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for o in oyuncular %}
                            <tr>
                                <td class="fw-bold">{{ o.isim }}</td>
                                <td>
                                    {% for m in o.mevkiler %}
                                        <span class="badge bg-secondary">{{ m }}</span>
                                    {% endfor %}
                                </td>
                                <td>
                                    {% for m, p in o.puanlar.items() %}
                                        <small class="d-block text-muted">{{ m }}: <b>{{ p }}</b></small>
                                    {% endfor %}
                                </td>
                                <td><a href="/sil/{{ o.id }}" class="text-danger"><i class="bi bi-x-circle-fill"></i></a></td>
                            </tr>
                            {% else %}
                            <tr><td colspan="5" class="text-center py-4 text-muted">Hen羹z veri yok.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Kadro say覺lar覺na g繹re pop羹ler dizililer (Kaleci Hari癟: Def-Ort-For)
    const formations = {
        5: [
            {val: "1-2-1", txt: "1-2-1 (Elmas - Hal覺 Saha)"},
            {val: "2-1-1", txt: "2-1-1 (Defansif)"},
            {val: "1-1-2", txt: "1-1-2 (Ofansif)"},
            {val: "2-2-0", txt: "2-2-0 (Forvetsiz)"}
        ],
        6: [
            {val: "2-2-1", txt: "2-2-1 (Dengeli)"},
            {val: "3-1-1", txt: "3-1-1 (Salamc覺)"},
            {val: "2-1-2", txt: "2-1-2 (H羹cumcu)"},
            {val: "1-3-1", txt: "1-3-1 (Orta Saha)"}
        ],
        7: [
            {val: "2-3-1", txt: "2-3-1 (Klasik Hal覺 Saha)"},
            {val: "3-2-1", txt: "3-2-1 (am Aac覺)"},
            {val: "2-2-2", txt: "2-2-2 (Kare)"},
            {val: "3-1-2", txt: "3-1-2 (Kontra)"}
        ],
        8: [
            {val: "3-3-1", txt: "3-3-1 (Dengeli)"},
            {val: "3-2-2", txt: "3-2-2 (ift Forvet)"},
            {val: "2-4-1", txt: "2-4-1 (Kalabal覺k Orta)"},
            {val: "2-3-2", txt: "2-3-2 (Ofansif)"}
        ],
        9: [
            {val: "3-3-2", txt: "3-3-2 (Klasik 8v8)"},
            {val: "4-3-1", txt: "4-3-1 (Defansif)"},
            {val: "3-4-1", txt: "3-4-1 (Pas Oyunu)"},
            {val: "2-4-2", txt: "2-4-2 (Riskli)"}
        ],
        10: [
            {val: "4-3-2", txt: "4-3-2"},
            {val: "4-4-1", txt: "4-4-1"},
            {val: "3-4-2", txt: "3-4-2"},
            {val: "3-5-1", txt: "3-5-1"}
        ],
        11: [
            {val: "4-4-2", txt: "4-4-2 (Klasik)"},
            {val: "4-3-3", txt: "4-3-3 (Modern)"},
            {val: "4-2-3-1", txt: "4-2-3-1 (Dengeli)"},
            {val: "3-5-2", txt: "3-5-2 (Kanat Bekli)"},
            {val: "3-4-3", txt: "3-4-3 (H羹cum)"}
        ]
    };

    function updateFormations() {
        const countInput = document.getElementById("kisiSayisiInput");
        const select = document.getElementById("dizilisSelect");
        let count = parseInt(countInput.value);

        // S覺n覺rlar覺 koru
        if (count < 5) count = 5;
        if (count > 11) count = 11;

        // Mevcut se癟enekleri temizle (Sadece 'Farketmez' kals覺n istemiyoruz, onu da ekleyeceiz)
        select.innerHTML = "";

        // nce Farketmez se癟eneini ekle
        let optAuto = document.createElement("option");
        optAuto.value = "farketmez";
        optAuto.text = " Farketmez (Yapay Zeka)";
        optAuto.selected = true;
        select.appendChild(optAuto);

        // 襤lgili say覺ya ait dizilileri ekle
        if (formations[count]) {
            formations[count].forEach(f => {
                let opt = document.createElement("option");
                // 4-2-3-1 gibi 4 par癟al覺lar覺 Python'da basitletirmek i癟in 
                // backend sadece 3 par癟a (DEF-MID-FW) bekliyor.
                // 4-2-3-1 asl覺nda 4-5-1 grubudur (MID=5). 
                // Ama g繹rsel olarak 4-2-3-1 yazs覺n, value basit olsun diye basit tutuyoruz.
                // imdilik backend'e uygun formatta (DEF-MID-FW) deer atayal覺m.
                
                // 4-2-3-1 -> Asl覺nda 4 Def, 5 Orta, 1 Forvet.
                // 11 Kii i癟in Backend kodu: parts[0]=DEF, parts[1]=MID, parts[2]=FW
                
                // Kullan覺c覺ya karma覺k g繹stermemek i癟in basit tuttum, 
                // ama 4-2-3-1 gibi 繹zel taktikler i癟in Python taraf覺n覺 g羹ncellemek gerekir.
                // imdilik standart 3'l羹 yap覺lar覺 kullan覺yoruz.
                opt.value = f.val; 
                opt.text = f.txt;
                select.appendChild(opt);
            });
        }
    }

    // Sayfa a癟覺ld覺覺nda 癟al覺t覺r
    window.onload = updateFormations;
</script>

</body>
</html>